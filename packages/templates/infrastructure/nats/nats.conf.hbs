# NATS Server Configuration for {{project.name}}
# Generated by SaaSQuatch - Enterprise-Grade Tools for Ambitious Startups

# ===================================================================
# Server Configuration
# ===================================================================

# Server name (hostname will be used if not specified)
# server_name: "{{project.name}}-nats"

# Client connection port
port: 4222

# HTTP monitoring port
http_port: 8222

# Maximum number of client connections
max_connections: 1000

# Maximum payload size (1MB default)
max_payload: 1048576

# Maximum control line size
max_control_line: 4096

# Maximum pending messages size per client (64MB)
max_pending: 67108864

# Ping interval to check client liveness
ping_interval: "2m"

# Maximum pings without response before disconnect
ping_max: 3

# Write deadline for client connections
write_deadline: "10s"

# ===================================================================
# JetStream Configuration
# ===================================================================

jetstream {
  # Enable JetStream
  # JetStream provides persistent messaging, exactly-once delivery,
  # and message replay capabilities

  # Storage directory for JetStream data
  store_dir: "/data"

  # Maximum storage for JetStream (1GB default)
  max_file_store: 1GB

  # Maximum memory for JetStream (75% of available memory)
  # max_memory_store: 768MB

  # Sync always ensures data is written to disk before acknowledging
  # Set to false for better performance at risk of potential data loss
  sync_always: true

  # Sync interval when sync_always is false
  # sync_interval: "2s"

  # Enable unique message IDs
  # unique_tag: "{{project.name}}"
}

# ===================================================================
# Logging Configuration
# ===================================================================

# Enable debug logging (set to false in production)
debug: false

# Enable trace logging (very verbose, set to false in production)
trace: false

# Enable logging timestamp
logtime: true

# Enable logging file and line number
# log_file: "/logs/nats.log"

# Enable syslog logging
# syslog: true

# Log to stdout (for Docker)
# logfile: "/dev/stdout"

# ===================================================================
# Limits
# ===================================================================

# Maximum subscriptions per client
max_subscriptions: 1000

# Maximum number of slow consumers
# max_slow_consumers: 10

# Slow consumer threshold
# slow_consumer_threshold: "10s"

# ===================================================================
# Clustering Configuration (for multi-node setup)
# ===================================================================

# cluster {
#   # Cluster name
#   name: "{{project.name}}-cluster"
#
#   # Cluster listen URL
#   listen: "0.0.0.0:6222"
#
#   # Routes to other cluster nodes
#   routes: [
#     "nats://nats-1:6222"
#     "nats://nats-2:6222"
#     "nats://nats-3:6222"
#   ]
#
#   # Cluster connection timeout
#   connect_retries: 30
#
#   # Authorization for cluster connections
#   # authorization {
#   #   user: cluster_user
#   #   password: cluster_password
#   # }
# }

# ===================================================================
# Security Configuration
# ===================================================================

# Authorization (uncomment to enable)
# authorization {
#   # Default user
#   user: "{{project.name}}_user"
#   password: "change_me_in_production"
#
#   # Timeout for authentication
#   timeout: 5
# }

# Multiple users (uncomment to enable)
# authorization {
#   users = [
#     {
#       user: "admin"
#       password: "admin_password"
#       permissions: {
#         publish: ">"
#         subscribe: ">"
#       }
#     }
#     {
#       user: "service"
#       password: "service_password"
#       permissions: {
#         publish: ["events.>", "requests.>"]
#         subscribe: ["events.>", "responses.>"]
#       }
#     }
#   ]
# }

# Token authentication (uncomment to enable)
# authorization {
#   token: "your_secure_token_here"
# }

# ===================================================================
# TLS Configuration (for secure connections)
# ===================================================================

# tls {
#   # Server certificate
#   cert_file: "/certs/nats-server.crt"
#
#   # Server private key
#   key_file: "/certs/nats-server.key"
#
#   # CA certificate for client verification
#   ca_file: "/certs/ca.crt"
#
#   # Verify client certificates
#   verify: true
#
#   # Timeout for TLS handshake
#   timeout: 5
# }

# ===================================================================
# Account Configuration (for multi-tenancy)
# ===================================================================

# accounts {
#   # System account
#   SYS: {
#     users: [
#       { user: "sys", password: "sys_password" }
#     ]
#   }
#
#   # Application accounts
#   {{#each services}}
#   {{uppercase this.name}}: {
#     users: [
#       {
#         user: "{{this.name}}_user"
#         password: "{{this.name}}_password"
#       }
#     ]
#     jetstream: enabled
#   }
#   {{/each}}
# }

# System account for monitoring
# system_account: SYS

# ===================================================================
# Performance Tuning
# ===================================================================

# Disable no-op tracing for better performance
# disable_sublist_cache: false

# Maximum number of cores to use
# max_procs: 0  # 0 = use all available cores

# ===================================================================
# Monitoring & Observability
# ===================================================================

# Enable server monitoring endpoint
# http_base_path: "/"

# Include monitoring metrics
# include_system_account: false

# ===================================================================
# Gateway Configuration (for super-clusters)
# ===================================================================

# gateway {
#   name: "{{project.name}}"
#   listen: "0.0.0.0:7222"
#
#   # Connect to other gateways
#   gateways: [
#     { name: "cluster-a", url: "nats://gateway-a:7222" }
#     { name: "cluster-b", url: "nats://gateway-b:7222" }
#   ]
# }

# ===================================================================
# Leaf Node Configuration (for edge deployments)
# ===================================================================

# leafnodes {
#   listen: "0.0.0.0:7422"
#
#   # Remote leaf node connections
#   remotes: [
#     {
#       url: "nats://hub.example.com:7422"
#       credentials: "/creds/leaf.creds"
#     }
#   ]
# }

# ===================================================================
# Webhooks Configuration (for event notifications)
# ===================================================================

# webhooks {
#   # Webhook for connection events
#   connection: {
#     url: "http://webhook-service:8080/nats/connection"
#     headers: {
#       "Authorization": "Bearer webhook_token"
#     }
#   }
#
#   # Webhook for disconnection events
#   disconnection: {
#     url: "http://webhook-service:8080/nats/disconnection"
#   }
# }

# ===================================================================
# End of Configuration
# ===================================================================
