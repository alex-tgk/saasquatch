# Product Requirements Document: SaaSQuatch

**Generated:** 2025-11-01
**Version:** 0.1.0
**Project Type:** CLI Tool / Code Generator
**Status:** Phase 1 (70% Complete) - Ready for Implementation Week 1

---

## Table of Contents

1. [Executive Summary](#executive-summary)
2. [Technical Stack Analysis](#technical-stack-analysis)
3. [Feature Inventory](#feature-inventory)
4. [Architecture Overview](#architecture-overview)
5. [Gap Analysis](#gap-analysis)
6. [Development Phases with Tasks](#development-phases-with-tasks)
7. [Technical Considerations](#technical-considerations)
8. [Risk Assessment](#risk-assessment)

---

## Executive Summary

### Vision

**SaaSQuatch** is a production-ready CLI tool that generates complete microservices architectures using Fastify, PostgreSQL/SQLite, Redis, and NATS. Developers run one command and get a fully-configured SaaS platform with authentication, multi-tenancy, observability, and comprehensive testing.

### Current Status

**Phase 1 Implementation: 70% Complete**

- âœ… **CLI Architecture**: Excellent (8/10) - Professional Commander.js setup with Inquirer prompts
- âœ… **Configuration Schema**: Comprehensive Zod validation with TypeScript inference
- âœ… **Template System**: 88 Handlebars templates with strong Fastify patterns
- âš ï¸ **Code Generation**: Functional but incomplete (missing routes, migrations)
- âš ï¸ **Generated Project Viability**: Blocked by empty pnpm-workspace.yaml
- âš ï¸ **Testing**: Minimal coverage (~20%, target 80%+)

### Key Achievements

1. **Complete Interactive CLI**: 405-line prompt system with conditional logic and validation
2. **Comprehensive Templates**: Auth service, user service, infrastructure, Next.js dashboard
3. **Advanced Features**: Self-healing port allocation, multi-tenancy, JWT authentication
4. **Production Patterns**: Fastify plugins, JSON Schema validation, structured logging

### Critical Blockers

1. âŒ Empty `pnpm-workspace.yaml` breaks generated monorepos
2. âŒ Auth service incomplete (no routes, missing AuthService class)
3. âŒ SQL injection vulnerability in multi-tenancy
4. âŒ No password hashing implementation
5. âŒ Test coverage far below 80% target

---

## Technical Stack Analysis

### Core Technologies

#### CLI Tool
- **Language**: TypeScript 5.3 (strict mode, ESM modules)
- **CLI Framework**: Commander.js 11.1 + Inquirer.js 9.3
- **Generator**: Plop.js 4.0 + Handlebars 4.7
- **Validation**: Zod 3.22 (config schema)
- **Package Manager**: pnpm 8+ (workspaces)
- **Build Tool**: tsc (TypeScript compiler) + tsx (dev)
- **Testing**: Jest 29.7

#### Generated Services (Fastify)
- **Framework**: Fastify 4.24 (plugin-based architecture)
- **Database**: PostgreSQL 16 OR SQLite + Knex.js 3.1
- **Cache**: Redis 7-alpine + ioredis 5.3
- **Message Queue**: NATS 2.10-alpine
- **Authentication**: @fastify/jwt 8.0 + bcrypt 5.1
- **Logging**: Pino (Fastify native)
- **Validation**: JSON Schema (Fastify native) + TypeBox
- **Tracing**: OpenTelemetry (basic setup)

#### Generated Dashboard
- **Framework**: Next.js 14 (App Router)
- **UI Library**: shadcn/ui + Radix UI
- **Styling**: Tailwind CSS 3.4
- **Icons**: Lucide React
- **API Client**: Native fetch

### Development Tools
- **Package Manager**: pnpm 8+
- **Build Tool**: TypeScript compiler
- **Testing**: Jest with ts-jest
- **Linting**: ESLint 8.56
- **Version Control**: Git
- **Container**: Docker + Docker Compose

### Infrastructure
- **Containerization**: Docker multi-stage builds
- **Orchestration**: Docker Compose (Phase 1)
- **Database**: PostgreSQL 16-alpine OR SQLite
- **Cache**: Redis 7-alpine
- **Message Queue**: NATS 2.10-alpine
- **Volumes**: Named volumes for data persistence
- **Networking**: Bridge network with DNS

---

## Feature Inventory

### Existing Features

#### âœ… CLI Core (Complete)
- **Interactive Prompts** (405 lines)
  - Project name, description, author
  - Database type selection (PostgreSQL/SQLite)
  - Multi-tenancy configuration
  - Service selection and configuration
  - Use case templates (SaaS, eCommerce, API-first, Realtime)
  - Advanced configuration mode
  - Input validation and conditional logic

- **Command System**
  - `saasquatch init` - Full implementation (349 lines)
  - `saasquatch add` - Placeholder (future)
  - `saasquatch test` - Placeholder (future)
  - `saasquatch deploy` - Placeholder (future)

- **Configuration Management**
  - Zod schema with 200+ lines of validation
  - TypeScript type inference
  - ConfigBuilder utility pattern
  - Config loading from file (--config flag)
  - Default configuration generation (--yes flag)
  - Dry-run mode (--dry-run flag)

#### âœ… Template System (Complete)
- **Template Engine**
  - Handlebars 4.7 with caching
  - Custom helpers (snakeCase, uppercase, eq, or, and, not, json)
  - Directory rendering
  - File filtering (.gitkeep exclusion)
  - Context-based generation

- **88 Template Files**
  - Base service: 15 templates
  - Auth service: 7 templates
  - User service: 12 templates
  - Infrastructure: 5 templates
  - Dashboard: 47 templates (Next.js 14)

#### âš ï¸ Code Generation (70% Complete)
- **Project Generator** (932+ lines)
  - âœ… Root project structure
  - âœ… pnpm workspace configuration (structure exists, content empty)
  - âœ… Root package.json, tsconfig.json, .gitignore
  - âœ… Service directory creation
  - âœ… Infrastructure Docker Compose
  - âš ï¸ Service generation (template-based incomplete)
  - âš ï¸ Auth service (missing routes and services)
  - âŒ Dashboard generation (templates exist, not wired)
  - âŒ Shared utilities (empty directories only)
  - âŒ Documentation generation (placeholder only)

#### âš ï¸ Service Templates (60-90% Complete)
- **Base Service** (95% complete)
  - âœ… Main app factory (app.ts.hbs)
  - âœ… Server entry point with self-healing ports (index.ts.hbs)
  - âœ… Health, readiness, metrics endpoints
  - âœ… Database, Redis, NATS, Auth plugins
  - âœ… Swagger/OpenAPI configuration
  - âœ… Port manager utility
  - âš ï¸ Auth routes (placeholders with TODOs)

- **Auth Service** (40% complete)
  - âœ… TokenService (268 lines, comprehensive)
  - âœ… Auth plugin (@fastify/jwt integration)
  - âœ… Database plugin (user queries)
  - âœ… Redis plugin (token blacklist)
  - âœ… TypeScript declarations
  - âœ… Unit tests for TokenService (417 lines, excellent)
  - âŒ app.ts (missing)
  - âŒ index.ts (missing)
  - âŒ Auth routes (missing)
  - âŒ AuthService class (missing)
  - âŒ Password hashing (missing)
  - âŒ Integration tests (missing)
  - âŒ Migrations (missing)

- **User Service** (90% complete)
  - âœ… Full CRUD routes (489 lines)
  - âœ… Multi-tenancy middleware
  - âœ… Tenant service (schema management)
  - âœ… NATS event publishing
  - âœ… Database, Redis, NATS plugins
  - âœ… Knex migration template
  - âœ… Integration tests (613 lines)
  - âœ… Multi-tenancy tests (320 lines, partial)
  - âš ï¸ SQL injection vulnerability (critical fix needed)

- **Infrastructure** (95% complete)
  - âœ… Docker Compose (224 lines)
  - âœ… PostgreSQL, Redis, NATS containers
  - âœ… Health checks and dependencies
  - âœ… Volume configuration
  - âœ… Init scripts
  - âœ… Makefile (210 lines)
  - âš ï¸ Missing service container definitions
  - âŒ Dockerfile templates (referenced but don't exist)

- **Dashboard** (85% complete)
  - âœ… Next.js 14 App Router structure
  - âœ… Service health monitoring
  - âœ… Redis viewer
  - âœ… NATS inspector
  - âœ… Logs viewer
  - âœ… Metrics charts
  - âœ… shadcn/ui components
  - âš ï¸ No authentication
  - âš ï¸ Hard-coded service list
  - âš ï¸ Polling-based updates (no WebSocket)

#### âš ï¸ Testing (20% Complete, Target 80%)
- **CLI Tests**
  - âœ… Config validation unit tests (80% coverage)
  - âœ… Project generation integration tests (60% coverage)
  - âŒ cli.ts tests (0% coverage)
  - âŒ commands/init.ts tests (0% coverage)
  - âŒ prompts tests (0% coverage)
  - âŒ template-renderer tests (0% coverage)
  - âŒ handlebars-helpers tests (0% coverage)

- **Service Template Tests**
  - âœ… TokenService unit tests (excellent)
  - âœ… User routes integration tests (excellent)
  - âš ï¸ Tenant tests (partial)
  - âŒ Base service tests (0%)
  - âŒ Auth integration tests (0%)
  - âŒ API gateway tests (0%)
  - âŒ Dashboard tests (0%)

---

## Architecture Overview

### Directory Structure

```
saasquatch/                          # CLI tool repository (pnpm monorepo)
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ cli/                         # Main CLI tool
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ cli.ts               # âœ… CLI entry point
â”‚   â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ config.types.ts  # âœ… Zod schema (203 lines)
â”‚   â”‚   â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ init.ts          # âœ… Init command (349 lines)
â”‚   â”‚   â”‚   â”œâ”€â”€ prompts/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ project.prompts.ts # âœ… Inquirer (405 lines)
â”‚   â”‚   â”‚   â”œâ”€â”€ generators/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ project.generator.ts # âš ï¸ 932 lines (70% done)
â”‚   â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚   â”‚       â”œâ”€â”€ template-renderer.ts # âœ… Handlebars
â”‚   â”‚   â”‚       â””â”€â”€ handlebars-helpers.ts # âœ… Custom helpers
â”‚   â”‚   â”œâ”€â”€ test/                    # âš ï¸ Minimal coverage
â”‚   â”‚   â”‚   â”œâ”€â”€ unit/                # 1 test file
â”‚   â”‚   â”‚   â””â”€â”€ integration/         # 1 test file
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â”œâ”€â”€ templates/                   # âœ… 88 Handlebars templates
â”‚   â”‚   â”œâ”€â”€ base-service/            # âœ… 15 templates
â”‚   â”‚   â”œâ”€â”€ auth-service/            # âš ï¸ 7 templates (40% complete)
â”‚   â”‚   â”œâ”€â”€ user-service/            # âœ… 12 templates (90% complete)
â”‚   â”‚   â”œâ”€â”€ infrastructure/          # âœ… 5 templates (95% complete)
â”‚   â”‚   â””â”€â”€ dashboard/               # âœ… 47 templates (85% complete)
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                        # âŒ Missing (planned shared utilities)
â”‚   â””â”€â”€ docs/                        # âŒ Missing (planned CLI docs)
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ planning/                    # â† PRD lives here
â”‚   â”‚   â””â”€â”€ prd-2025-11-01.md
â”‚   â””â”€â”€ START-HERE.md                # âœ… Onboarding guide
â”‚
â”œâ”€â”€ .claude/                         # âœ… Claude Code context
â”‚   â”œâ”€â”€ agents/                      # 30+ agents
â”‚   â”œâ”€â”€ skills/                      # 40+ skills
â”‚   â””â”€â”€ commands/                    # Custom slash commands
â”‚
â”œâ”€â”€ package.json                     # âœ… Root monorepo config
â”œâ”€â”€ pnpm-workspace.yaml              # âŒ CRITICAL: Empty file!
â””â”€â”€ tsconfig.json                    # âœ… TypeScript config
```

### Generated Project Structure

When users run `npx @saasquatch/cli init my-project`:

```
my-project/                          # Generated pnpm monorepo
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ auth-service/                # Port 3001 - JWT auth
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ app.ts               # âŒ NOT GENERATED
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts             # âŒ NOT GENERATED
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/              # âŒ NOT GENERATED
â”‚   â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ token.service.ts # âœ… Generated
â”‚   â”‚   â”‚   â””â”€â”€ plugins/             # âœ… Generated
â”‚   â”‚   â”œâ”€â”€ migrations/              # âŒ NOT GENERATED
â”‚   â”‚   â””â”€â”€ test/                    # âš ï¸ Partial
â”‚   â”‚
â”‚   â”œâ”€â”€ user-service/                # Port 3002 - User CRUD
â”‚   â”‚   â”œâ”€â”€ src/                     # âœ… Fully generated
â”‚   â”‚   â”œâ”€â”€ migrations/              # âœ… Generated
â”‚   â”‚   â””â”€â”€ test/                    # âœ… Generated
â”‚   â”‚
â”‚   â””â”€â”€ api-gateway/                 # Port 3000 - Entry point
â”‚       â””â”€â”€ src/                     # âŒ Template missing
â”‚
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ docker-compose.yml           # âš ï¸ Incomplete
â”‚   â”œâ”€â”€ redis/
â”‚   â”œâ”€â”€ postgresql/
â”‚   â””â”€â”€ nats/
â”‚
â”œâ”€â”€ dashboard/                       # Next.js monitoring UI
â”‚   â”œâ”€â”€ app/                         # âŒ NOT GENERATED
â”‚   â”œâ”€â”€ components/                  # âŒ NOT GENERATED
â”‚   â””â”€â”€ lib/                         # âŒ NOT GENERATED
â”‚
â”œâ”€â”€ shared/                          # Shared utilities
â”‚   â””â”€â”€ (empty)                      # âŒ NOT GENERATED
â”‚
â”œâ”€â”€ saasquatch.config.json           # âœ… Generated
â”œâ”€â”€ package.json                     # âœ… Generated
â”œâ”€â”€ pnpm-workspace.yaml              # âŒ EMPTY - CRITICAL BUG
â””â”€â”€ README.md                        # âš ï¸ Basic template
```

### Key Patterns

#### 1. Configuration-Driven Architecture
```typescript
// Everything flows from saasquatch.config.json
{
  "project": { "name", "description" },
  "infrastructure": { "database", "cache", "messageQueue" },
  "services": [
    {
      "name": "auth-service",
      "port": 3001,
      "features": { "database": true, "jwt": true }
    }
  ]
}
// â†’ Zod validation â†’ TypeScript types â†’ Template context â†’ Generated code
```

#### 2. Fastify Plugin Architecture
```typescript
// All features as plugins
import databasePlugin from './plugins/database.js';
import redisPlugin from './plugins/redis.js';

await app.register(databasePlugin);
await app.register(redisPlugin);
```

#### 3. JSON Schema Validation
```typescript
// Every route has JSON Schema
fastify.post('/users', {
  schema: {
    body: UserSchema,
    response: { 201: UserResponseSchema }
  }
}, handler);
```

#### 4. Multi-Tenancy Pattern
```typescript
// PostgreSQL schema-per-tenant
await db.raw('SET search_path TO ??', [`tenant_${tenantId}`]);
// All queries now scoped to tenant schema
```

#### 5. Self-Healing Port Allocation
```typescript
// Automatic port conflict resolution
const port = await getAvailablePort('auth-service', 3001);
// If 3001 occupied, tries 3002, 3003... and caches result
```

### Data Flow

```
User Input (CLI) â†’ Inquirer Prompts â†’ Zod Validation
                                            â†“
                                      Config Object
                                            â†“
                     Template Renderer (Handlebars)
                                            â†“
                        Generated Files (TypeScript)
                                            â†“
              Services â†’ Plugins â†’ Routes â†’ Handlers
                   â†“                  â†“
                Database          JSON Schema
                   â†“                  â†“
              Multi-Tenant        Validation
```

---

## Gap Analysis

### Critical Gaps (Blocking MVP)

#### 1. Empty pnpm-workspace.yaml ğŸš¨
**Severity**: CRITICAL
**Impact**: Generated projects cannot run (workspaces don't work)
**File**: Generated root `pnpm-workspace.yaml`
**Current**: Empty file
**Required**:
```yaml
packages:
  - 'services/*'
  - 'shared'
  - 'dashboard'
```
**Blocking**: All generated projects

---

#### 2. Auth Service Incomplete ğŸš¨
**Severity**: CRITICAL
**Impact**: Core authentication functionality missing
**Files Missing**:
- `packages/templates/auth-service/src/app.ts.hbs`
- `packages/templates/auth-service/src/index.ts.hbs`
- `packages/templates/auth-service/src/routes/auth.routes.ts.hbs`
- `packages/templates/auth-service/src/services/auth.service.ts.hbs`
- `packages/templates/auth-service/migrations/001_create_users.ts.hbs`

**What Exists**:
- âœ… TokenService (JWT token management)
- âœ… Database, Redis, Auth plugins
- âœ… Unit tests for TokenService

**What's Missing**:
- âŒ Route handlers (POST /auth/register, /auth/login, /auth/logout, /auth/refresh, GET /auth/me)
- âŒ AuthService class (password hashing, user registration, login logic)
- âŒ Database migrations (users table schema)
- âŒ Integration tests (full auth flow)

**Blocking**: Authentication feature

---

#### 3. No Password Hashing ğŸš¨
**Severity**: CRITICAL (Security)
**Impact**: Passwords would be stored in plaintext
**File**: Missing in auth-service templates
**Required**: Bcrypt implementation in AuthService
```typescript
// Needed in AuthService:
import bcrypt from 'bcrypt';

const SALT_ROUNDS = 10;
const hashedPassword = await bcrypt.hash(password, SALT_ROUNDS);
const isValid = await bcrypt.compare(password, user.password);
```
**Blocking**: Authentication security

---

#### 4. SQL Injection in Multi-Tenancy ğŸš¨
**Severity**: CRITICAL (Security)
**Impact**: Database compromise via malicious tenant IDs
**Files**:
- `packages/templates/user-service/src/services/tenant.service.ts.hbs` (lines 30, 47, 104)
- `packages/templates/user-service/src/routes/user.routes.ts.hbs` (lines 90, 155, 216, 312, 429)

**Vulnerable Code**:
```typescript
// UNSAFE:
await this.db.raw(`SET search_path TO ${schemaName}, public`);
```

**Fix Required**:
```typescript
// SAFE:
await this.db.raw('SET search_path TO ??, public', [schemaName]);
```
**Blocking**: Multi-tenancy security

---

#### 5. Missing Dockerfile Templates ğŸš¨
**Severity**: HIGH
**Impact**: Docker Compose references non-existent Dockerfiles
**Files Missing**:
- `packages/templates/base-service/Dockerfile.hbs`
- `packages/templates/auth-service/Dockerfile.hbs`
- `packages/templates/user-service/Dockerfile.hbs`
- `packages/templates/api-gateway/Dockerfile.hbs`

**Current**: docker-compose.yml has `build: ./services/auth-service` but no Dockerfile
**Blocking**: Container deployments

---

### Enhancement Gaps (Reduces Value)

#### 6. Dashboard Not Generated
**Severity**: MEDIUM
**Impact**: Loses major value proposition (observability UI)
**Status**: 47 Next.js templates exist but `generateDashboard()` is empty
**File**: `/Users/acarroll/dev/projects/saasquatch/packages/cli/src/generators/project.generator.ts:820-825`
**Fix**: Wire up template rendering

---

#### 7. Test Coverage Far Below Target
**Severity**: MEDIUM
**Impact**: Reduced confidence, harder to refactor
**Current**: ~20% coverage
**Target**: 80%+
**Missing**:
- CLI tests (prompts, commands, template renderer)
- Service template tests (base-service, auth routes, API gateway)
- E2E tests (full workflow validation)

---

#### 8. Missing API Gateway Template
**Severity**: MEDIUM
**Impact**: No unified entry point for services
**Status**: Planned but templates don't exist
**Required**:
- Request proxying
- Service discovery
- JWT validation at gateway
- Rate limiting aggregation
- CORS handling

---

### Technical Debt

#### 9. Dual Code Paths in Generator
**Severity**: MEDIUM
**Impact**: Maintenance burden, inconsistency risk
**File**: `project.generator.ts`
**Issue**: Has both template-based generation AND legacy hard-coded methods:
- `generateServiceLegacy()` (200+ lines)
- `generateAppFile()`, `generateIndexFile()`, etc.

**Fix**: Remove legacy methods, consolidate to template-only

---

#### 10. Empty Generator Methods
**Severity**: LOW
**Impact**: Confusion, misleading code
**Methods**:
```typescript
async generateShared(): Promise<void> {
  // TODO: Implement shared package generation
  console.log(chalk.gray('Not yet implemented'));
}

async generateDocumentation(): Promise<void> {
  // TODO: Generate comprehensive documentation
}
```
**Fix**: Implement or remove

---

## Development Phases with Tasks

### Phase 1: Critical Fixes (Week 1-2, 15-20 hours)

**Goal**: Unblock generated project functionality and fix security issues

#### TASK-001: Fix Empty pnpm-workspace.yaml ğŸš¨
- **Priority**: CRITICAL
- **Complexity**: S (Small)
- **Estimated Time**: 0.5 hours
- **Dependencies**: None
- **Files to Modify**:
  - `packages/cli/src/generators/project.generator.ts:96-101`
- **Acceptance Criteria**:
  - [ ] Generated `pnpm-workspace.yaml` contains packages array
  - [ ] Includes 'services/*', 'shared', 'dashboard'
  - [ ] Test: Run `pnpm install` in generated project (should work)
- **Implementation**:
```typescript
// In generateRoot():
const workspaceContent = `packages:
  - 'services/*'
  - 'shared'
  - 'dashboard'
`;
await fs.writeFile(
  path.join(projectDir, 'pnpm-workspace.yaml'),
  workspaceContent
);
```

---

#### TASK-002: Fix SQL Injection in Multi-Tenancy ğŸš¨
- **Priority**: CRITICAL (Security)
- **Complexity**: S
- **Estimated Time**: 2 hours
- **Dependencies**: None
- **Files to Modify**:
  - `packages/templates/user-service/src/services/tenant.service.ts.hbs` (3 locations)
  - `packages/templates/user-service/src/routes/user.routes.ts.hbs` (5 locations)
- **Acceptance Criteria**:
  - [ ] All `SET search_path` uses parameterized queries
  - [ ] All `CREATE SCHEMA` uses parameterized queries
  - [ ] Add `validateTenantId()` function (regex: `/^[a-z0-9-]{1,63}$/`)
  - [ ] Add test case for malicious tenant ID rejection
- **Implementation**:
```typescript
// Replace all:
await this.db.raw(`SET search_path TO ${schemaName}, public`);
// With:
await this.db.raw('SET search_path TO ??, public', [schemaName]);
```

---

#### TASK-003: Complete Auth Service Templates ğŸš¨
- **Priority**: CRITICAL
- **Complexity**: L (Large)
- **Estimated Time**: 8 hours
- **Dependencies**: TASK-002 (security patterns)
- **Files to Create**:
  - `packages/templates/auth-service/src/app.ts.hbs`
  - `packages/templates/auth-service/src/index.ts.hbs`
  - `packages/templates/auth-service/src/routes/auth.routes.ts.hbs`
  - `packages/templates/auth-service/src/services/auth.service.ts.hbs`
  - `packages/templates/auth-service/migrations/001_create_users.ts.hbs`
  - `packages/templates/auth-service/test/integration/auth.routes.test.ts.hbs`
- **Acceptance Criteria**:
  - [ ] AuthService class with register(), login(), logout(), refreshToken(), getCurrentUser()
  - [ ] Password hashing with bcrypt (10 rounds)
  - [ ] Auth routes with JSON Schema validation
  - [ ] Users table migration with uuid, email, password, name, last_login, timestamps
  - [ ] Integration tests for full auth flow (register â†’ login â†’ refresh â†’ logout)
  - [ ] Error handling (409 Conflict for duplicate email, 401 for invalid credentials)
- **Implementation Notes**:
```typescript
// src/services/auth.service.ts.hbs
export class AuthService {
  async register(data: RegisterDto): Promise<User> {
    const hashedPassword = await bcrypt.hash(data.password, 10);
    const user = await this.db('users').insert({
      email: data.email,
      password: hashedPassword,
      name: data.name
    }).returning('*');
    return this.sanitizeUser(user[0]);
  }

  async login(email: string, password: string): Promise<AuthResponse> {
    const user = await this.db('users').where({ email }).first();
    if (!user) throw new UnauthorizedError('Invalid credentials');

    const isValid = await bcrypt.compare(password, user.password);
    if (!isValid) throw new UnauthorizedError('Invalid credentials');

    const tokens = await this.tokenService.generateTokenPair(user);
    await this.db('users').where({ id: user.id }).update({ last_login: new Date() });

    return { user: this.sanitizeUser(user), ...tokens };
  }

  // ... logout, refreshToken, getCurrentUser
}
```

---

#### TASK-004: Create Dockerfile Templates
- **Priority**: CRITICAL
- **Complexity**: M (Medium)
- **Estimated Time**: 3 hours
- **Dependencies**: None
- **Files to Create**:
  - `packages/templates/base-service/Dockerfile.hbs`
  - `packages/templates/auth-service/Dockerfile.hbs` (if different)
  - `packages/templates/user-service/Dockerfile.hbs` (if different)
  - `packages/templates/api-gateway/Dockerfile.hbs`
  - `packages/templates/dashboard/Dockerfile.hbs`
- **Acceptance Criteria**:
  - [ ] Multi-stage build (builder + runtime)
  - [ ] Node 20-alpine base image
  - [ ] Non-root user (node)
  - [ ] Proper layer caching (copy package.json first)
  - [ ] Health check configured
  - [ ] Expose correct port (from config)
- **Implementation**:
```dockerfile
# packages/templates/base-service/Dockerfile.hbs
FROM node:20-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
RUN npm run build

FROM node:20-alpine
WORKDIR /app
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/node_modules ./node_modules
COPY package*.json ./
USER node
EXPOSE {{service.port}}
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s \
  CMD node -e "require('http').get('http://localhost:{{service.port}}/health', (r) => process.exit(r.statusCode === 200 ? 0 : 1))"
CMD ["node", "dist/index.js"]
```

---

#### TASK-005: Fix Weak JWT Secret Handling ğŸš¨
- **Priority**: HIGH (Security)
- **Complexity**: S
- **Estimated Time**: 1 hour
- **Dependencies**: None
- **Files to Modify**:
  - `packages/templates/base-service/src/plugins/auth.ts.hbs:13-18`
  - `packages/templates/auth-service/src/plugins/auth.plugin.ts.hbs:24-29`
- **Acceptance Criteria**:
  - [ ] Require JWT_SECRET at runtime (throw if missing)
  - [ ] Reduce access token expiry from 7d to 15m
  - [ ] Add JWT_ACCESS_TOKEN_EXPIRY and JWT_REFRESH_TOKEN_EXPIRY env vars
  - [ ] Update .env.example templates
- **Implementation**:
```typescript
// auth.ts.hbs
if (!process.env.JWT_SECRET) {
  throw new Error('JWT_SECRET environment variable is required');
}

await fastify.register(jwt, {
  secret: process.env.JWT_SECRET,
  sign: {
    expiresIn: process.env.JWT_ACCESS_TOKEN_EXPIRY || '15m' // Changed from 7d
  }
});
```

---

### Phase 2: Core Functionality (Week 3-4, 20-25 hours)

**Goal**: Complete essential features and improve DX

#### TASK-006: Wire Up Dashboard Generation
- **Priority**: HIGH
- **Complexity**: M
- **Estimated Time**: 2 hours
- **Dependencies**: None
- **Files to Modify**:
  - `packages/cli/src/generators/project.generator.ts:820-825`
- **Acceptance Criteria**:
  - [ ] `generateDashboard()` calls template renderer
  - [ ] Renders all 47 dashboard templates
  - [ ] package.json includes correct dependencies
  - [ ] Test: Generated dashboard builds (`pnpm build`)
  - [ ] Test: Dashboard runs (`pnpm dev`)
- **Implementation**:
```typescript
async generateDashboard(projectDir: string): Promise<void> {
  const dashboardDir = path.join(projectDir, 'dashboard');

  await this.renderer.renderDirectory(
    'dashboard',
    dashboardDir,
    {
      project: this.config.project,
      services: this.config.services,
      infrastructure: this.config.infrastructure
    }
  );
}
```

---

#### TASK-007: Add Global Error Handler
- **Priority**: HIGH
- **Complexity**: M
- **Estimated Time**: 2 hours
- **Dependencies**: None
- **Files to Create**:
  - `packages/templates/base-service/src/utils/error-handler.ts.hbs`
- **Files to Modify**:
  - `packages/templates/base-service/src/app.ts.hbs` (register error handler)
- **Acceptance Criteria**:
  - [ ] Handles validation errors (400)
  - [ ] Handles JWT errors (401)
  - [ ] Handles not found errors (404)
  - [ ] Handles generic errors (500)
  - [ ] Logs errors with structured logging
  - [ ] Hides stack traces in production
  - [ ] Returns consistent error format
- **Implementation**:
```typescript
app.setErrorHandler((error, request, reply) => {
  request.log.error({ err: error, reqId: request.id }, 'Request error');

  if (error.validation) {
    return reply.code(400).send({
      statusCode: 400,
      error: 'Validation Error',
      message: 'Request validation failed',
      details: error.validation
    });
  }

  if (error.statusCode === 401 || error.code?.startsWith('FST_JWT_')) {
    return reply.code(401).send({
      statusCode: 401,
      error: 'Unauthorized',
      message: 'Invalid or expired token'
    });
  }

  reply.code(error.statusCode || 500).send({
    statusCode: error.statusCode || 500,
    error: error.name || 'Internal Server Error',
    message: process.env.NODE_ENV === 'production'
      ? 'An error occurred'
      : error.message
  });
});
```

---

#### TASK-008: Complete Docker Compose Service Definitions
- **Priority**: HIGH
- **Complexity**: M
- **Estimated Time**: 2 hours
- **Dependencies**: TASK-004 (Dockerfiles)
- **Files to Modify**:
  - `packages/templates/infrastructure/docker-compose.yml.hbs`
- **Acceptance Criteria**:
  - [ ] Add service definitions for auth-service, user-service, api-gateway, dashboard
  - [ ] Configure health checks for each service
  - [ ] Set up service dependencies (auth needs postgres+redis)
  - [ ] Configure networks
  - [ ] Add environment variable templating
  - [ ] Test: `docker-compose up` starts all services
- **Implementation**:
```yaml
services:
  auth-service:
    build: ./services/auth-service
    ports:
      - "3001:3001"
    environment:
      DATABASE_URL: postgres://postgres:postgres@postgres:5432/auth_db
      REDIS_URL: redis://redis:6379
      JWT_SECRET: ${JWT_SECRET}
      NODE_ENV: development
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3001/health"]
      interval: 10s
      timeout: 3s
      retries: 3
      start_period: 10s
```

---

#### TASK-009: Implement Transaction Helpers
- **Priority**: MEDIUM
- **Complexity**: M
- **Estimated Time**: 3 hours
- **Dependencies**: TASK-002 (multi-tenancy security)
- **Files to Create**:
  - `packages/templates/base-service/src/utils/transaction.ts.hbs`
- **Files to Modify**:
  - Update user routes to use transactions
- **Acceptance Criteria**:
  - [ ] `withTransaction()` helper function
  - [ ] Tenant context set via `SET LOCAL` (auto-resets)
  - [ ] Automatic rollback on error
  - [ ] Update CRUD routes to use transactions
  - [ ] Add tests for transaction rollback
- **Implementation**:
```typescript
export async function withTransaction<T>(
  db: Knex,
  tenantId: string | undefined,
  callback: (trx: Knex.Transaction) => Promise<T>
): Promise<T> {
  return db.transaction(async (trx) => {
    if (tenantId) {
      await trx.raw('SET LOCAL search_path TO ??', [`tenant_${tenantId}`]);
    }
    return callback(trx);
  });
}

// Usage in routes:
await withTransaction(fastify.db, request.user?.tenantId, async (trx) => {
  await trx('users').insert(userData);
  await trx('audit_log').insert(auditEntry);
});
```

---

#### TASK-010: Create API Gateway Template
- **Priority**: MEDIUM
- **Complexity**: L
- **Estimated Time**: 6 hours
- **Dependencies**: TASK-003 (auth for JWT validation)
- **Files to Create**:
  - `packages/templates/api-gateway/src/app.ts.hbs`
  - `packages/templates/api-gateway/src/index.ts.hbs`
  - `packages/templates/api-gateway/src/routes/proxy.ts.hbs`
  - `packages/templates/api-gateway/src/plugins/service-discovery.ts.hbs`
  - `packages/templates/api-gateway/src/config/services.config.ts.hbs`
- **Acceptance Criteria**:
  - [ ] HTTP proxy with @fastify/http-proxy
  - [ ] Service discovery (static config + health checks)
  - [ ] JWT validation at gateway level
  - [ ] Rate limiting (per-user, per-IP)
  - [ ] CORS handling
  - [ ] Request logging with trace IDs
  - [ ] Circuit breaker pattern
- **Implementation Notes**:
```typescript
// routes/proxy.ts.hbs
fastify.register(httpProxy, {
  upstream: 'http://auth-service:3001',
  prefix: '/auth',
  rewritePrefix: '/auth',
  preHandler: async (request, reply) => {
    // JWT validation for protected routes
    if (request.url !== '/auth/login' && request.url !== '/auth/register') {
      await request.jwtVerify();
    }
  }
});
```

---

### Phase 3: Testing & Quality (Week 5-6, 20-25 hours)

**Goal**: Reach 80%+ test coverage and production readiness

#### TASK-011: Create CLI Unit Tests
- **Priority**: MEDIUM
- **Complexity**: L
- **Estimated Time**: 8 hours
- **Dependencies**: None
- **Files to Create**:
  - `packages/cli/test/unit/utils/template-renderer.test.ts`
  - `packages/cli/test/unit/utils/handlebars-helpers.test.ts`
  - `packages/cli/test/unit/prompts/project.prompts.test.ts`
  - `packages/cli/test/unit/commands/init.test.ts`
  - `packages/cli/test/unit/cli.test.ts`
- **Acceptance Criteria**:
  - [ ] Test template compilation and caching
  - [ ] Test all 12 custom Handlebars helpers
  - [ ] Test prompt validation and conditional logic
  - [ ] Test CLI argument parsing
  - [ ] Test error handling
  - [ ] Achieve 80%+ coverage for CLI package
- **Implementation Examples**:
```typescript
// test/unit/utils/handlebars-helpers.test.ts
describe('Handlebars Helpers', () => {
  describe('snakeCase', () => {
    it('converts camelCase to snake_case', () => {
      expect(snakeCase('myVariableName')).toBe('my_variable_name');
    });
  });

  describe('eq', () => {
    it('returns true when values are equal', () => {
      expect(eq('foo', 'foo')).toBe(true);
    });
  });

  // ... test all 12 helpers
});
```

---

#### TASK-012: Create Base Service Test Templates
- **Priority**: MEDIUM
- **Complexity**: M
- **Estimated Time**: 4 hours
- **Dependencies**: None
- **Files to Create**:
  - `packages/templates/base-service/test/unit/plugins/database.test.ts.hbs`
  - `packages/templates/base-service/test/unit/plugins/redis.test.ts.hbs`
  - `packages/templates/base-service/test/unit/plugins/nats.test.ts.hbs`
  - `packages/templates/base-service/test/unit/utils/port-manager.test.ts.hbs`
  - `packages/templates/base-service/test/integration/health.test.ts.hbs`
  - `packages/templates/base-service/test/integration/app.test.ts.hbs`
- **Acceptance Criteria**:
  - [ ] Test database connection and health check
  - [ ] Test Redis connection and graceful degradation
  - [ ] Test NATS connection
  - [ ] Test port manager caching and fallback
  - [ ] Test health/ready/metrics endpoints
  - [ ] Test app initialization
  - [ ] Generated services have 80%+ test coverage

---

#### TASK-013: Add E2E Test Suite
- **Priority**: MEDIUM
- **Complexity**: L
- **Estimated Time**: 6 hours
- **Dependencies**: TASK-003 (auth), TASK-008 (docker-compose)
- **Files to Create**:
  - `packages/cli/test/e2e/full-workflow.test.ts`
  - `packages/cli/test/e2e/helpers/docker.ts`
  - `packages/cli/test/e2e/helpers/wait-for-health.ts`
- **Acceptance Criteria**:
  - [ ] Test full `saasquatch init` command
  - [ ] Test `pnpm install` in generated project
  - [ ] Test `pnpm build` in generated project
  - [ ] Test `pnpm test` in generated project (should pass)
  - [ ] Test `docker-compose up`
  - [ ] Test auth flow (register â†’ login â†’ refresh)
  - [ ] Test service health endpoints
  - [ ] Cleanup (docker-compose down, remove temp directory)
- **Implementation**:
```typescript
describe('E2E: Full Workflow', () => {
  it('generates, builds, and runs a working project', async () => {
    // Generate project
    await execa('node', ['dist/cli.js', 'init', 'e2e-test', '--yes']);

    // Install & build
    await execa('pnpm', ['install'], { cwd: projectPath });
    await execa('pnpm', ['build'], { cwd: projectPath });

    // Run tests
    const { stdout } = await execa('pnpm', ['test'], { cwd: projectPath });
    expect(stdout).toContain('Tests passed');

    // Start services
    await execa('docker-compose', ['up', '-d'], { cwd: projectPath });
    await waitForHealth('http://localhost:3001/health');

    // Test auth flow
    const registerRes = await fetch('http://localhost:3001/auth/register', {
      method: 'POST',
      body: JSON.stringify({ email: 'test@test.com', password: 'Test123!' })
    });
    expect(registerRes.status).toBe(201);

    // Cleanup
    await execa('docker-compose', ['down'], { cwd: projectPath });
  }, 300000); // 5 min timeout
});
```

---

#### TASK-014: Create Test Utility Templates
- **Priority**: MEDIUM
- **Complexity**: M
- **Estimated Time**: 3 hours
- **Dependencies**: None
- **Files to Create**:
  - `packages/templates/shared/test/jest.config.js.hbs`
  - `packages/templates/shared/test/setup.ts.hbs`
  - `packages/templates/shared/test/factories/user.factory.ts.hbs`
  - `packages/templates/shared/test/factories/tenant.factory.ts.hbs`
  - `packages/templates/shared/test/mocks/redis.mock.ts.hbs`
  - `packages/templates/shared/test/mocks/database.mock.ts.hbs`
  - `packages/templates/shared/test/helpers/test-app.ts.hbs`
- **Acceptance Criteria**:
  - [ ] Jest configuration template with coverage thresholds
  - [ ] Test setup with global mocks
  - [ ] Factory functions for test data generation
  - [ ] Mock implementations for external dependencies
  - [ ] Test Fastify app builder
- **Implementation**:
```typescript
// factories/user.factory.ts.hbs
import { faker } from '@faker-js/faker';

export function createUser(overrides?: Partial<User>): User {
  return {
    id: faker.string.uuid(),
    email: faker.internet.email(),
    name: faker.person.fullName(),
    createdAt: faker.date.past(),
    updatedAt: faker.date.recent(),
    ...overrides
  };
}
```

---

### Phase 4: Documentation & Polish (Week 7-8, 15-20 hours)

**Goal**: Production-ready documentation and developer experience

#### TASK-015: Generate OpenAPI Documentation
- **Priority**: LOW
- **Complexity**: M
- **Estimated Time**: 3 hours
- **Dependencies**: None
- **Files to Create**:
  - `packages/templates/base-service/src/utils/openapi.ts.hbs`
- **Files to Modify**:
  - `packages/templates/base-service/src/config/swagger.config.ts.hbs`
- **Acceptance Criteria**:
  - [ ] Automatic OpenAPI schema generation from JSON Schema
  - [ ] Swagger UI at /docs endpoint
  - [ ] Authentication endpoints documented
  - [ ] Example requests/responses
  - [ ] Tag-based organization
- **Implementation**:
```typescript
await app.register(swagger, {
  openapi: {
    info: {
      title: '{{service.name}} API',
      version: '1.0.0'
    },
    servers: [
      { url: 'http://localhost:{{service.port}}', description: 'Development' }
    ],
    components: {
      securitySchemes: {
        bearerAuth: {
          type: 'http',
          scheme: 'bearer',
          bearerFormat: 'JWT'
        }
      }
    }
  }
});
await app.register(swaggerUi, { routePrefix: '/docs' });
```

---

#### TASK-016: Generate Architecture Diagrams
- **Priority**: LOW
- **Complexity**: M
- **Estimated Time**: 3 hours
- **Dependencies**: None
- **Files to Create**:
  - `packages/templates/docs/ARCHITECTURE.md.hbs` (with Mermaid diagrams)
- **Acceptance Criteria**:
  - [ ] System architecture diagram (services, infrastructure)
  - [ ] Data flow diagram (request â†’ service â†’ database)
  - [ ] Multi-tenancy diagram (schema-per-tenant)
  - [ ] Authentication flow diagram
  - [ ] Deployment diagram
- **Implementation**:
```markdown
## System Architecture

\`\`\`mermaid
graph TB
    Client[Client] --> Gateway[API Gateway:3000]
    Gateway --> Auth[Auth Service:3001]
    Gateway --> User[User Service:3002]
    Auth --> Postgres[(PostgreSQL)]
    Auth --> Redis[(Redis)]
    User --> Postgres
    User --> Redis
    User --> NATS[(NATS)]
\`\`\`
```

---

#### TASK-017: Generate Comprehensive README
- **Priority**: LOW
- **Complexity**: S
- **Estimated Time**: 2 hours
- **Dependencies**: None
- **Files to Modify**:
  - `packages/templates/root/README.md.hbs`
- **Acceptance Criteria**:
  - [ ] Quick start section (5 minutes to running app)
  - [ ] Prerequisites (Node, pnpm, Docker)
  - [ ] Installation instructions
  - [ ] Running services (docker-compose up)
  - [ ] Environment variables documentation
  - [ ] Testing instructions
  - [ ] Deployment guide
  - [ ] Troubleshooting section
  - [ ] Links to service-specific READMEs

---

#### TASK-018: Add CI/CD Pipeline Templates
- **Priority**: LOW
- **Complexity**: M
- **Estimated Time**: 4 hours
- **Dependencies**: TASK-011, TASK-012 (tests exist)
- **Files to Create**:
  - `packages/templates/root/.github/workflows/test.yml.hbs`
  - `packages/templates/root/.github/workflows/deploy.yml.hbs`
- **Acceptance Criteria**:
  - [ ] GitHub Actions workflow for testing
  - [ ] Run tests on pull request
  - [ ] Coverage reporting
  - [ ] Build verification
  - [ ] Deployment workflow (placeholder)
- **Implementation**:
```yaml
name: Test
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v2
      - uses: actions/setup-node@v3
        with:
          node-version: '20'
          cache: 'pnpm'
      - run: pnpm install
      - run: pnpm test
      - run: pnpm build
```

---

#### TASK-019: Add Pre-commit Hooks
- **Priority**: LOW
- **Complexity**: S
- **Estimated Time**: 1 hour
- **Dependencies**: None
- **Files to Create**:
  - `packages/templates/root/.husky/pre-commit.hbs`
- **Acceptance Criteria**:
  - [ ] Husky setup in generated projects
  - [ ] Run linting on staged files
  - [ ] Run type checking
  - [ ] Prevent commits with errors
- **Implementation**:
```bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

pnpm lint-staged
pnpm tsc --noEmit
```

---

#### TASK-020: Remove Legacy Generator Code
- **Priority**: LOW
- **Complexity**: M
- **Estimated Time**: 2 hours
- **Dependencies**: TASK-006 (dashboard wired), TASK-003 (auth complete)
- **Files to Modify**:
  - `packages/cli/src/generators/project.generator.ts`
- **Acceptance Criteria**:
  - [ ] Delete `generateServiceLegacy()` method
  - [ ] Delete hard-coded generation methods (generateAppFile, etc.)
  - [ ] Consolidate to template-only generation
  - [ ] Test: All services still generate correctly
- **Implementation**: Remove 200+ lines of legacy code

---

## Technical Considerations

### Performance

**Targets**:
- CLI startup time: < 1 second
- Project generation time: < 2 minutes (excluding npm install)
- Service startup time: < 5 seconds
- API response time: < 100ms (P95)

**Optimizations**:
- Template caching (already implemented)
- Fastify's performance (native JSON parsing, fast routing)
- Connection pooling (min: 2, max: 10 connections)
- Redis caching for frequently accessed data
- Self-healing port allocation (avoids conflicts)

**Monitoring**:
- Pino structured logging
- OpenTelemetry tracing (basic setup)
- Prometheus metrics (optional)
- Health/ready/metrics endpoints

### Security

**Authentication**:
- JWT with refresh tokens
- Token rotation support
- Token blacklist (Redis)
- Bcrypt password hashing (10 rounds)
- 15-minute access token expiry (configurable)

**Authorization**:
- JWT payload includes user ID, tenant ID, roles
- Route-level authentication decorators
- Multi-tenant isolation at database level

**Data Protection**:
- Parameterized SQL queries (prevent injection)
- JSON Schema validation (prevent invalid input)
- Rate limiting (100 req/min default, configurable per route)
- CORS configuration
- Helmet security headers
- HTTPS enforcement (production)

**Critical Fixes Needed**:
1. ğŸš¨ SQL injection in multi-tenancy (TASK-002)
2. ğŸš¨ No password hashing (TASK-003)
3. ğŸš¨ Weak JWT secret handling (TASK-005)
4. âš ï¸ Dashboard has no authentication (future)

### Scalability

**Horizontal Scaling**:
- Stateless services (JWT in header, no sessions)
- Database connection pooling
- Redis for shared state
- NATS for inter-service messaging
- Docker Compose â†’ Kubernetes migration path

**Database**:
- Schema-per-tenant for multi-tenancy
- Separate database per service
- Connection pooling (min: 2, max: 10)
- Read replicas (future)
- Database per tenant option (large tenants)

**Caching**:
- Redis for token blacklist
- Redis for session storage
- Redis for frequently accessed data
- Configurable TTL per cache key
- Graceful degradation if Redis unavailable

**Message Queue**:
- NATS for event publishing
- Fire-and-forget pattern (logged errors)
- Async event handlers (future)
- Event replay capability (future)

### Testing Strategy

**Current Coverage**: ~20%
**Target Coverage**: 80%+

**Unit Tests** (TASK-011, TASK-012):
- CLI utilities, helpers, prompts
- Service plugins, utilities
- Business logic (AuthService, TenantService)
- 80%+ coverage for critical code paths

**Integration Tests** (existing, expand in TASK-012):
- API endpoints (already excellent for user-service)
- Full auth flow (register â†’ login â†’ refresh)
- Database operations
- Multi-tenancy isolation

**E2E Tests** (TASK-013):
- Full CLI workflow (init â†’ build â†’ test â†’ run)
- Service health checks
- Cross-service communication
- Docker Compose orchestration

**Test Infrastructure**:
- Jest with ts-jest
- Supertest for API testing
- Test factories for data generation
- Mock implementations for external dependencies
- In-memory databases for fast tests

---

## Risk Assessment

### Technical Risks

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| **SQL injection in multi-tenancy** | Critical | High | TASK-002: Fix immediately with parameterized queries |
| **Empty pnpm-workspace.yaml breaks projects** | Critical | High | TASK-001: 30-minute fix, highest priority |
| **Auth service incomplete** | Critical | High | TASK-003: 8-hour implementation, well-scoped |
| **Database connection pool exhaustion** | High | Medium | Increase pool size, add connection monitoring |
| **Redis unavailability affects auth** | Medium | Low | Fail-open strategy already implemented |
| **Port conflicts in development** | Low | Medium | Self-healing port allocation already implemented |
| **Template rendering errors** | Medium | Low | Add error handling, validation in TASK-006 |

### Project Risks

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| **Test coverage stays below 80%** | High | Medium | TASK-011, TASK-012, TASK-013: Comprehensive test creation |
| **Generated projects don't run** | Critical | High | TASK-001, TASK-004, TASK-008: Fix blockers first |
| **Developer confusion (missing docs)** | Medium | High | TASK-015, TASK-016, TASK-017: Comprehensive docs |
| **Maintenance burden (dual code paths)** | Medium | Medium | TASK-020: Remove legacy code |
| **Breaking changes to templates** | Low | Low | Version templates, maintain backwards compatibility |

### Security Risks

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| **Passwords stored in plaintext** | Critical | High | TASK-003: Implement bcrypt immediately |
| **Weak default JWT secret** | Critical | High | TASK-005: Require secret at runtime |
| **SQL injection vulnerability** | Critical | High | TASK-002: Parameterized queries |
| **No rate limiting on auth endpoints** | High | Medium | Add stricter rate limits (5 req/5min) |
| **Dashboard accessible to anyone** | Medium | Medium | Add authentication (future) |
| **No SSL/TLS in Docker Compose** | Medium | Low | Document production deployment with HTTPS |

---

## Appendix

### Project Files Reference

#### Core CLI Files
- `/Users/acarroll/dev/projects/saasquatch/packages/cli/src/cli.ts` (92 lines)
- `/Users/acarroll/dev/projects/saasquatch/packages/cli/src/types/config.types.ts` (203 lines)
- `/Users/acarroll/dev/projects/saasquatch/packages/cli/src/commands/init.ts` (349 lines)
- `/Users/acarroll/dev/projects/saasquatch/packages/cli/src/prompts/project.prompts.ts` (405 lines)
- `/Users/acarroll/dev/projects/saasquatch/packages/cli/src/generators/project.generator.ts` (932+ lines)
- `/Users/acarroll/dev/projects/saasquatch/packages/cli/src/utils/template-renderer.ts` (88 lines)
- `/Users/acarroll/dev/projects/saasquatch/packages/cli/src/utils/handlebars-helpers.ts` (54 lines)

#### Template Files
- `/Users/acarroll/dev/projects/saasquatch/packages/templates/base-service/` (15 templates)
- `/Users/acarroll/dev/projects/saasquatch/packages/templates/auth-service/` (7 templates, 40% complete)
- `/Users/acarroll/dev/projects/saasquatch/packages/templates/user-service/` (12 templates, 90% complete)
- `/Users/acarroll/dev/projects/saasquatch/packages/templates/infrastructure/` (5 templates, 95% complete)
- `/Users/acarroll/dev/projects/saasquatch/packages/templates/dashboard/` (47 templates, 85% complete)

#### Test Files
- `/Users/acarroll/dev/projects/saasquatch/packages/cli/test/unit/config-validation.test.ts`
- `/Users/acarroll/dev/projects/saasquatch/packages/cli/test/integration/init.test.ts`
- `/Users/acarroll/dev/projects/saasquatch/packages/templates/auth-service/test/unit/services/token.service.test.ts.hbs`
- `/Users/acarroll/dev/projects/saasquatch/packages/templates/user-service/test/user.routes.test.ts.hbs`
- `/Users/acarroll/dev/projects/saasquatch/packages/templates/user-service/test/tenant.test.ts.hbs`

### Success Metrics

#### MVP Complete When

**Functionality**:
- âœ… `saasquatch init` generates working project in < 2 min
- âœ… Auth service: register, login, JWT flow works
- âœ… User service: CRUD + multi-tenancy works
- âœ… Docker Compose starts all services
- âœ… Dashboard displays service health

**Code Quality**:
- âœ… TypeScript strict mode compiles
- âœ… 80%+ test coverage
- âœ… JSON Schema on all routes
- âœ… Structured logging (Pino)
- âœ… Health checks on all services
- âœ… No security vulnerabilities

**Documentation**:
- âœ… Root README with quickstart
- âœ… OpenAPI/Swagger at /docs
- âœ… Architecture diagrams
- âœ… Per-service READMEs
- âœ… Troubleshooting guide

### Quick Start (After MVP)

```bash
# Generate project
npx @saasquatch/cli init my-saas

# Install & start
cd my-saas
pnpm install
docker-compose up -d
pnpm dev

# Test auth flow
curl -X POST http://localhost:3001/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"Test123!","name":"Test User"}'

# View dashboard
open http://localhost:3100

# View API docs
open http://localhost:3001/docs
```

**Total Time**: < 5 minutes from zero to running SaaS platform

---

## Summary

### Current State: 70% Complete

**What's Working**:
- âœ… Excellent CLI architecture (8/10)
- âœ… Comprehensive configuration system
- âœ… 88 high-quality templates
- âœ… User service nearly complete (90%)
- âœ… Infrastructure templates excellent (95%)

**Critical Gaps**:
1. Empty pnpm-workspace.yaml (30 min fix)
2. Auth service incomplete (8 hours)
3. SQL injection vulnerability (2 hours)
4. No password hashing (included in auth fix)
5. Missing Dockerfiles (3 hours)
6. Test coverage too low (20 hours)

**Estimated Completion**:
- **Phase 1 (Critical Fixes)**: 15-20 hours (Week 1-2)
- **Phase 2 (Core Functionality)**: 20-25 hours (Week 3-4)
- **Phase 3 (Testing)**: 20-25 hours (Week 5-6)
- **Phase 4 (Documentation)**: 15-20 hours (Week 7-8)

**Total**: 70-90 hours to production-ready (approximately 2 months part-time)

### Next Steps

1. **Immediate** (Week 1): Fix blockers (TASK-001 through TASK-005)
2. **Week 2**: Complete core functionality (TASK-006 through TASK-010)
3. **Week 3-4**: Achieve 80%+ test coverage (TASK-011 through TASK-014)
4. **Week 5-6**: Polish and documentation (TASK-015 through TASK-020)

**Priority**: Start with TASK-001 (30 minutes) to unblock all generated projects immediately.
